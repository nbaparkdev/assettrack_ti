{% extends "base.html" %}

{% block content %}
<div class="max-w-3xl mx-auto fade-in">
    <!-- Form Container -->
    <div class="bg-white border-2 border-black p-0 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.2)]">
        <!-- Header -->
        <div class="bg-black p-6 border-b-2 border-black flex items-center justify-between">
            <div>
                <h2 class="text-2xl font-bold text-white uppercase tracking-wider flex items-center gap-3">
                    <span class="w-3 h-3 bg-amber-500 inline-block"></span>
                    Editar Usuário
                </h2>
                <p class="text-gray-400 font-mono text-xs mt-1 ml-6">ID: {{ target_user.id }} // {{ target_user.email }}
                </p>
            </div>
            <a href="/admin/users"
                class="text-xs font-bold text-white uppercase hover:text-gray-300 transition underline decoration-dashed underline-offset-4">
                Cancelar
            </a>
        </div>

        <form action="/admin/users/{{ target_user.id }}/edit" method="post" class="p-8 space-y-8">
            <!-- Section 1: Personal Info -->
            <div>
                <h3
                    class="font-mono text-xs font-bold text-gray-400 uppercase tracking-widest mb-6 border-b border-gray-200 pb-2">
                    Informações Pessoais</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="nome" class="block text-xs font-bold uppercase text-gray-900 mb-2">Nome Completo
                            *</label>
                        <input type="text" name="nome" id="nome" value="{{ target_user.nome }}" required
                            class="block w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-none focus:border-black focus:ring-0 transition placeholder-gray-400 font-bold text-black">
                    </div>

                    <div class="md:col-span-2">
                        <label for="email" class="block text-xs font-bold uppercase text-gray-900 mb-2">Email *</label>
                        <input type="email" name="email" id="email" value="{{ target_user.email }}" required
                            class="block w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-none focus:border-black focus:ring-0 transition font-mono text-sm">
                    </div>
                </div>
            </div>

            <!-- Section 2: Organizational Info -->
            <div>
                <h3
                    class="font-mono text-xs font-bold text-gray-400 uppercase tracking-widest mb-6 border-b border-gray-200 pb-2">
                    Dados Organizacionais</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="matricula"
                            class="block text-xs font-bold uppercase text-gray-900 mb-2">Matrícula</label>
                        <input type="text" name="matricula" id="matricula" value="{{ target_user.matricula or '' }}"
                            class="block w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-none focus:border-black focus:ring-0 transition font-mono uppercase">
                    </div>

                    <div>
                        <label for="cargo" class="block text-xs font-bold uppercase text-gray-900 mb-2">Cargo</label>
                        <input type="text" name="cargo" id="cargo" value="{{ target_user.cargo or '' }}"
                            class="block w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-none focus:border-black focus:ring-0 transition uppercase">
                    </div>

                    <div>
                        <label for="role" class="block text-xs font-bold uppercase text-gray-900 mb-2">Perfil de
                            Acesso</label>
                        <div class="relative">
                            <select name="role" id="role" required
                                class="block w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-none focus:border-black focus:ring-0 transition appearance-none uppercase text-sm cursor-pointer">
                                <option value="admin" {% if target_user.role.value|lower=='admin' %}selected{% endif %}>
                                    ADMINISTRADOR</option>
                                <option value="gerente_ti" {% if target_user.role.value|lower=='gerente_ti' %}selected{%
                                    endif %}>GERENTE TI</option>
                                <option value="tecnico" {% if target_user.role.value|lower=='tecnico' %}selected{% endif
                                    %}>TÉCNICO</option>
                                <option value="usuario_comum" {% if target_user.role.value|lower=='usuario_comum'
                                    %}selected{% endif %}>USUÁRIO COMUM</option>
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-700">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 20 20">
                                    <path
                                        d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-gray-900 mb-2">Status da Conta</label>
                        <div class="relative flex items-center h-[46px]">
                            <label class="inline-flex items-center cursor-pointer group">
                                <input type="checkbox" name="is_active" value="true" {% if target_user.is_active
                                    %}checked{% endif %} class="sr-only peer">
                                <div
                                    class="w-12 h-6 bg-gray-200 border-2 border-gray-300 peer-focus:outline-none rounded-none peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[12px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-none after:h-4 after:w-5 after:transition-all peer-checked:bg-green-600 peer-checked:border-green-600">
                                </div>
                                <span
                                    class="ms-3 text-xs font-bold uppercase text-gray-600 group-hover:text-black transition">Conta
                                    Ativa</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="border-t-2 border-gray-100 pt-6 flex flex-col md:flex-row items-center justify-between gap-4">
                <button type="submit"
                    class="w-full md:w-auto bg-black border-2 border-black text-white px-8 py-3 font-bold uppercase text-sm tracking-widest hover:bg-gray-800 transition shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,0.2)] hover:translate-x-[2px] hover:translate-y-[2px] active:shadow-none active:translate-x-[4px] active:translate-y-[4px] rounded-none">
                    Salvar Alterações
                </button>
            </div>
        </form>
    </div>

    <!-- Danger Zone -->
    {% if target_user.id != user.id %}
    <div class="mt-8 border-2 border-red-100 bg-red-50 p-6">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h3 class="font-bold text-red-700 uppercase tracking-wider text-sm mb-1">Zona de Perigo</h3>
                <p class="font-mono text-xs text-red-600">Ações irreversíveis. Tenha cuidado.</p>
            </div>
            <form action="/admin/users/{{ target_user.id }}/delete" method="post"
                onsubmit="return confirm('CRÍTICO: Tem certeza ABSOLUTA que deseja EXCLUIR {{ target_user.nome }}?');">
                <button type="submit"
                    class="bg-white border-2 border-red-600 text-red-600 px-6 py-2 font-bold uppercase text-xs hover:bg-red-600 hover:text-white transition">
                    [ Excluir Usuário ]
                </button>
            </form>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}